{"miyoushe":{"useimg":1,"img":"(upload-bbs.miyoushe.com/upload/\\d{4,}/\\d{2,}/\\d{2,}/)([0-9]*)/([A-Za-z0-9]*_[0-9]*)(.[A-Za-z0-9]*)(\\?*.*)","to":":\n// (upload-bbs.miyoushe.com/upload/\\d{4,}/\\d{2,}/\\d{2,}/)([0-9]*)(/[A-Za-z0-9]*_[0-9]*)(.[A-Za-z0-9]*)(\\?*.*)\n// 2 = userID 3 = filename 4 = format\n\nvar result = $[1] + $[2] + \"/\" + $[3] + $[4];\n\nvar imgBox = document.getElementsByClassName(\"ql-image-box\");\nfor (const e of imgBox) {\n  var img = e.getElementsByTagName(\"img\")[0];\n  if (img.src.match(result) != null) {\n    img.oncontextmenu = (event) => {\n      event.preventDefault();\n      let xhr = new XMLHttpRequest();\n      xhr.open('GET', \"https://\" + result, true);\n      xhr.responseType = 'blob';\n      xhr.onload = function() {\n        if (xhr.status === 200) {\n          if (window.miyoushe_count != null) {\n            window.miyoushe_count += 1;\n          } else {window.miyoushe_count = 0;}\n          var articleID = window.location.pathname.match(/(article\\/)([0-9]*)/)[2];\n          var fixedFileName = $[2] + \"_\" + articleID + \"_p\" + \n            window.miyoushe_count.toString() + $[4];\n\n          if (window.navigator.msSaveOrOpenBlob) {\n            navigator.msSaveBlob(xhr.response, fixedFileName);\n          } else {\n            let link = document.createElement('a');\n            link.href = window.URL.createObjectURL(xhr.response);\n            link.download = fixedFileName;\n            link.click();\n            window.URL.revokeObjectURL(link.href);\n          }\n        }\n      }\n      xhr.send();\n    };\n    break;\n  }\n}\n\nreturn result;\n"}}
