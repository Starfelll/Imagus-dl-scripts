{"lofter":{"useimg":1,"img":"(imglf..lf[127|126]+.net/img/[A-Za-z0-9]*/{0,})([A-Za-z0-9]*)(.[A-Za-z]*)(\\?.*)","to":":\n// (upload-bbs.miyoushe.com/upload/\\d{4,}/\\d{2,}/\\d{2,}/)([0-9]*)(/[A-Za-z0-9]*_[0-9]*)(.[A-Za-z0-9]*)(\\?*.*)\n// 2 = filename 3 = format\n\nvar result = $[1] + $[2] + $[3];\n\n//\nvar imgBox = document.getElementsByClassName(\"imgclasstag\");\n\n\nfor (const e of imgBox) {\n  var img = e.getElementsByTagName(\"img\")[0];\n  if (img.src.match(result) != null) {\n    img.oncontextmenu = (event) => {\n      event.preventDefault();\n      let xhr = new XMLHttpRequest();\n      xhr.open('GET', \"https://\" + result, true);\n      xhr.responseType = 'blob';\n      xhr.onload = function() {\n        if (xhr.status === 200) {\n          if (window.lofter_count != null) {\n            window.lofter_count += 1;\n          } else {window.lofter_count = 0;}\n          var postID = window.location.pathname.match(/post\\/([A-Za-z0-9]+_[A-Za-z0-9]+)/)[1];\n          //\n          var fixedFileName = window.location.host.split(\".\")[0] + \"_\" + postID + \"_p\" + \n            window.lofter_count.toString() + $[3];\n\n          if (window.navigator.msSaveOrOpenBlob) {\n            navigator.msSaveBlob(xhr.response, fixedFileName);\n          } else {\n            let link = document.createElement('a');\n            link.href = window.URL.createObjectURL(xhr.response);\n            link.download = fixedFileName;\n            link.click();\n            window.URL.revokeObjectURL(link.href);\n          }\n        }\n      }\n      xhr.send();\n    };\n    break;\n  }\n}\n\nreturn result;\n"}}
